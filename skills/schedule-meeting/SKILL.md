---
name: schedule-meeting
description: Use this skill when user asks to "schedule a meeting", "договорись о встрече", "назначь встречу", "согласуй время встречи", "meet with someone", or mentions scheduling time with another person.
tools: mcp__jobs__resolve_user, mcp__jobs__create_task, mcp__jobs__send_to_user, mcp__jobs__schedule_task
---

# Schedule Meeting

Согласование встречи с пользователем через cross-session communication.

**Переменные:**
- `{owner_username}` — @username владельца из системного промпта (Owner Telegram ID)

## Algorithm

### 1. Parse Request

Из запроса извлеки:
- **Участник**: @username, имя или ID
- **Временные слоты**: диапазон времени владельца (например "12:00-20:00")
- **Дата**: если указана, иначе "сегодня" или "завтра"
- **Цель**: если указана

### 2. Find User

```
resolve_user(query="@username или имя")
```

Если не найден — сообщи владельцу.

### 3. Create Meeting Task

Используй `create_task` с `kind="meeting"`:

```
create_task(
  user="@masha",
  title="Встреча {дата}",
  kind="meeting",
  context={"date": "{дата}", "slots": "{от}-{до}", "purpose": "{цель}"},
  message="Привет! Я личный ассистент {owner_username}. Он предлагает созвониться {дата} с {от} до {до} по МСК. Подскажи, в какое время тебе удобнее?"
)
```

**Формат первого сообщения:**
- "Привет! Я личный ассистент {owner_username}. Он предлагает созвониться завтра с 12:00 до 20:00 по МСК. Подскажи, в какое время тебе удобнее?"
- "Привет! Я личный ассистент {owner_username}. Он предлагает созвониться в четверг с 14:00 до 18:00 по МСК, обсудить проект. Подскажи, в какое время тебе удобнее?"

### 4. Сообщи владельцу

После создания задачи сообщи:
"Написал {user} — предложил созвон {дата} {слоты}. Жду ответа."

### 5. Handle Result

Результат придёт автоматически через уведомление от сессии пользователя.

**ВАЖНО: Действуй автономно.** Когда получишь подтверждение времени — сразу создай напоминание. Не жди дополнительного подтверждения от владельца.

### 6. Response Scenarios

**Человек выбрал время → СРАЗУ создай напоминание:**

1. Сообщи владельцу: "Встреча с @masha согласована на {дата} в {время} МСК"
2. Создай напоминание за 5 минут до встречи:
```
schedule_task(
  title="Встреча с @masha",
  prompt="Встреча с @masha через 5 минут. Используй скилл create-telemost чтобы создать ссылку Яндекс Телемост, затем отправь ссылку владельцу и @masha.",
  time="{согласованное_время - 5 минут}"
)
```

**Человек предлагает другое время:**

1. Сообщи владельцу: "Время {слоты} не подходит @masha. Предлагает: {варианты}. Какой выбираем?"
2. После ответа владельца — отправь подтверждение человеку через `send_to_user()`

**Человек не отвечает (>2 часов):**

Напомни через `send_to_user()`: "Жду время на встречу, подскажешь?"

**Полный отказ:**

Сообщи владельцу: "@masha не может встретиться. Причина: {если указана}"

---

## User Session Instructions

Инструкции для сессии пользователя (external user), который получает задачу `kind="meeting"`.

### Контекст задачи

Ты получишь задачу с context:
```json
{"date": "завтра", "slots": "12:00-20:00", "purpose": "обсудить проект"}
```

### Алгоритм

1. Спроси пользователя когда ему удобно в рамках указанных слотов
2. Если называет конкретное время — подтверди и отправь результат
3. Если предлагает другое — запиши и скажи что согласуешь

### Завершение

**Время согласовано:**
```
update_task(task_id="...", status="done", result="confirmed: 18:20")
send_summary_to_owner(summary="{Имя} подтвердил созвон в {время}")
```

**Нужно пересогласование:**
```
update_task(task_id="...", status="pending", result="user_suggests: 10:00, 11:00")
send_summary_to_owner(summary="{Имя} предлагает другое время: {варианты}")
```

**Отказ:**
```
update_task(task_id="...", status="cancelled", result="reason: занят")
send_summary_to_owner(summary="{Имя} не может встретиться: {причина}")
```

### Правила

- Будь кратким и вежливым
- Не предлагай время вне указанных слотов
- Если пользователь называет время — подтверди и заверши
- Если предлагает другое — скажи что согласуешь с владельцем
- Если отказывается — не настаивай
